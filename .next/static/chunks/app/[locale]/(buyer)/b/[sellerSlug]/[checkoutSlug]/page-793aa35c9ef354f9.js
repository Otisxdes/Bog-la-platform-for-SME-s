(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[917],{4222:function(e,t,r){Promise.resolve().then(r.bind(r,1233))},1233:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var s=r(7437),a=r(2265),l=r(9501),n=r(3590),o=r(7119),i=r(3687),c=r(2586);let d=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),u=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&r.indexOf(e)===t).join(" ")};var m={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let h=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:l=2,absoluteStrokeWidth:n,className:o="",children:i,iconNode:c,...d}=e;return(0,a.createElement)("svg",{ref:t,...m,width:s,height:s,stroke:r,strokeWidth:n?24*Number(l)/Number(s):l,className:u("lucide",o),...d},[...c.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(i)?i:[i]])}),x=((e,t)=>{let r=(0,a.forwardRef)((r,s)=>{let{className:l,...n}=r;return(0,a.createElement)(h,{ref:s,iconNode:t,className:u("lucide-".concat(d(e)),l),...n})});return r.displayName="".concat(e),r})("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),b=["Tashkent","Samarkand","Bukhara","Andijan","Namangan","Fergana","Nukus","Qarshi","Guliston","Termez","Jizzakh","Navoiy","Urgench","Kokand","Margilan","Other"],g=/^\+998\d{9}$/,y="w-full px-4 py-2.5 bg-white border border-gray-200 rounded-lg text-sm text-gray-900 transition-colors placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400",p="w-full px-4 pr-10 py-2.5 bg-white border border-gray-200 rounded-lg text-sm text-gray-900 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400 appearance-none bg-[url('data:image/svg+xml;charset=UTF-8,%3csvg%20xmlns%3d%22http%3a%2f%2fwww.w3.org%2f2000%2fsvg%22%20width%3d%2220%22%20height%3d%2220%22%20viewBox%3d%220%200%2024%2024%22%20fill%3d%22none%22%20stroke%3d%22%239ca3af%22%20stroke-width%3d%222%22%3e%3cpath%20d%3d%22m6%209%206%206%206-6%22%2f%3e%3c%2fsvg%3e')] bg-[length:20px] bg-[right_12px_center] bg-no-repeat";function f(e){let{params:t}=e,r=(0,a.use)(t),d=(0,c.useTranslations)("buyer.checkout"),u=(0,i.tv)(),[m,h]=(0,a.useState)(null),[f,v]=(0,a.useState)(!0),[N,j]=(0,a.useState)(!1),[w,k]=(0,a.useState)(null),[S,C]=(0,a.useState)(1),[_,z,E]=function(e,t){let[r,s]=(0,a.useState)(null),[l,n]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(n(!0),e)try{let t=window.localStorage.getItem(e);t&&s(JSON.parse(t))}catch(t){console.warn('Error reading localStorage key "'.concat(e,'":'),t)}},[e]);let o=(0,a.useCallback)(t=>{if(e)try{let a=t instanceof Function?t(r):t;s(a),window.localStorage.setItem(e,JSON.stringify(a))}catch(t){console.warn('Error setting localStorage key "'.concat(e,'":'),t)}},[e,r]);return[r,o,(0,a.useCallback)(()=>{if(e)try{s(null),window.localStorage.removeItem(e)}catch(t){console.warn('Error removing localStorage key "'.concat(e,'":'),t)}},[e,null])]}(m?"bogla_".concat(m.seller.id,"_buyerProfile"):"",null),q=o.Ry({fullName:o.Z_().min(1,d("errors.fullNameRequired")),phone:o.Z_().regex(g,d("errors.phoneInvalid")),city:o.Z_().min(1,d("errors.cityRequired")),address:o.Z_().min(1,d("errors.addressRequired")),username:o.Z_().optional(),selectedSize:o.Z_().min(1,d("errors.sizeRequired")),deliveryMethod:o.Z_().min(1,d("errors.deliveryRequired")),quantity:o.Rx().int().positive().min(1),saveDetails:o.Km(["no","yes"]).default("no")}),{register:D,handleSubmit:M,formState:{errors:R},setValue:O,watch:P}=(0,l.cI)({resolver:(0,n.F)(q),defaultValues:{quantity:1,saveDetails:"no"}});P("deliveryMethod"),(0,a.useEffect)(()=>{(async function(){try{let e=await fetch("/api/checkout-links/".concat(r.sellerSlug,"/").concat(r.checkoutSlug));if(!e.ok)throw Error("Failed to load checkout link");let t=await e.json();h(t),C(t.defaultQty||1),O("quantity",t.defaultQty||1)}catch(e){k(d("errors.loadFailed")),console.error(e)}finally{v(!1)}})()},[r.sellerSlug,r.checkoutSlug,O,d]),(0,a.useEffect)(()=>{_&&m&&(O("fullName",_.fullName),O("phone",_.phone),O("city",_.city),O("address",_.address),_.username&&O("username",_.username))},[_,m,O]);let Q=async e=>{if(m){j(!0),k(null);try{let t={checkoutLinkId:m.id,quantity:e.quantity,selectedSize:e.selectedSize,deliveryMethod:e.deliveryMethod,buyer:{fullName:e.fullName,phone:e.phone,city:e.city,address:e.address,username:e.username},saveDetails:"yes"===e.saveDetails},s=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to create order")}let a=await s.json();if("yes"===e.saveDetails){let t={fullName:e.fullName,phone:e.phone,city:e.city,address:e.address,username:e.username};z(t)}u.push("/b/".concat(r.sellerSlug,"/").concat(r.checkoutSlug,"/success?orderId=").concat(a.id))}catch(e){k(e.message||"Failed to place order. Please try again."),j(!1)}}};if(f)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-500",children:d("../../common.loading")})]})});if(w&&!m)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gray-50",children:(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("p",{className:"text-red-600 mb-4",children:w})})});if(!m)return null;let F=m.deliveryOptions,I=[];return F.courierCity&&I.push({value:"courier_city",label:d("courierCity")}),F.pickup&&I.push({value:"pickup",label:d("pickup")}),F.region&&I.push({value:"region",label:d("regionDelivery")}),(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-100",children:(0,s.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-4 flex items-center gap-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>window.history.back(),className:"p-2 -ml-2 rounded-lg hover:bg-gray-100 transition-colors text-gray-600",children:(0,s.jsx)(x,{className:"w-5 h-5"})}),(0,s.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:m.seller.name})]})}),(0,s.jsxs)("main",{className:"max-w-2xl mx-auto px-4 py-6",children:[_&&(0,s.jsxs)("div",{className:"bg-blue-50 border border-blue-100 rounded-xl p-4 mb-6",children:[(0,s.jsx)("p",{className:"text-sm text-blue-800 mb-3",children:d("useSavedDetails")}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{_&&(O("fullName",_.fullName),O("phone",_.phone),O("city",_.city),O("address",_.address),_.username&&O("username",_.username))},className:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:d("useSavedDetails")}),(0,s.jsx)("button",{type:"button",onClick:()=>E(),className:"px-4 py-2 bg-white text-blue-600 border border-blue-200 rounded-lg text-sm font-medium hover:bg-blue-50 transition-colors",children:"Edit manually"})]}),(0,s.jsx)("button",{type:"button",onClick:()=>E(),className:"mt-3 text-xs text-blue-600 hover:underline",children:d("clearSavedDetails")})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6",children:[m.imageUrl&&(0,s.jsx)("div",{className:"mb-4 rounded-lg overflow-hidden",children:(0,s.jsx)("img",{src:m.imageUrl,alt:m.name,className:"w-full h-64 object-cover",onError:e=>{e.currentTarget.style.display="none"}})}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:m.name}),(0,s.jsxs)("p",{className:"text-3xl font-bold text-gray-900 mb-4",children:[m.price.toLocaleString()," ",m.currency]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:d("quantity")}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{let e=Math.max(1,S-1);C(e),O("quantity",e)},className:"w-10 h-10 flex items-center justify-center border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-gray-600 disabled:opacity-50",disabled:S<=1,children:"âˆ’"}),(0,s.jsx)("span",{className:"text-lg font-semibold w-12 text-center text-gray-900",children:S}),(0,s.jsx)("button",{type:"button",onClick:()=>{let e=m.maxQty?Math.min(m.maxQty,S+1):S+1;C(e),O("quantity",e)},className:"w-10 h-10 flex items-center justify-center border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-gray-600 disabled:opacity-50",disabled:!!m.maxQty&&S>=m.maxQty,children:"+"})]}),m.maxQty&&(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["Maximum: ",m.maxQty]})]}),m.sizes&&m.sizes.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[d("selectSize")," *"]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:m.sizes.map(e=>(0,s.jsxs)("label",{className:"cursor-pointer",children:[(0,s.jsx)("input",{type:"radio",value:e,...D("selectedSize"),className:"peer sr-only"}),(0,s.jsx)("div",{className:"px-4 py-2 border-2 border-gray-200 rounded-lg text-sm font-medium text-gray-700 peer-checked:border-blue-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 hover:border-gray-300 transition-colors",children:e})]},e))}),R.selectedSize&&(0,s.jsx)("p",{className:"mt-2 text-sm text-red-500",children:R.selectedSize.message})]})]}),(0,s.jsxs)("form",{onSubmit:M(Q),className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[d("deliveryMethod")," *"]}),(0,s.jsxs)("select",{...D("deliveryMethod"),className:p,children:[(0,s.jsx)("option",{value:"",children:d("deliveryMethod")}),I.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))]}),R.deliveryMethod&&(0,s.jsx)("p",{className:"mt-1.5 text-sm text-red-500",children:R.deliveryMethod.message})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:d("contactInfo")}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:[d("fullName")," *"]}),(0,s.jsx)("input",{type:"text",placeholder:d("fullNamePlaceholder"),...D("fullName"),className:y}),R.fullName&&(0,s.jsx)("p",{className:"mt-1.5 text-sm text-red-500",children:R.fullName.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:[d("phone")," *"]}),(0,s.jsx)("input",{type:"tel",placeholder:d("phonePlaceholder"),...D("phone"),className:y}),R.phone&&(0,s.jsx)("p",{className:"mt-1.5 text-sm text-red-500",children:R.phone.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:[d("city")," *"]}),(0,s.jsxs)("select",{...D("city"),className:p,children:[(0,s.jsx)("option",{value:"",children:d("selectCity")}),b.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),R.city&&(0,s.jsx)("p",{className:"mt-1.5 text-sm text-red-500",children:R.city.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:[d("address")," *"]}),(0,s.jsx)("textarea",{...D("address"),rows:3,placeholder:d("addressPlaceholder"),className:"".concat(y," resize-none")}),R.address&&(0,s.jsx)("p",{className:"mt-1.5 text-sm text-red-500",children:R.address.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:d("telegram")}),(0,s.jsx)("input",{type:"text",placeholder:d("telegramPlaceholder"),...D("username"),className:y})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:d("saveDetails")}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("label",{className:"flex items-center gap-3 p-3.5 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50/80 transition-colors has-[:checked]:border-blue-300 has-[:checked]:bg-blue-50/30",children:[(0,s.jsx)("div",{className:"relative flex items-center justify-center",children:(0,s.jsx)("input",{type:"radio",value:"no",...D("saveDetails"),className:"peer w-4 h-4 border border-gray-300 rounded-full appearance-none checked:border-blue-500 checked:border-[5px] transition-all cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-100"})}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:d("saveNo")})]}),(0,s.jsxs)("label",{className:"flex items-center gap-3 p-3.5 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50/80 transition-colors has-[:checked]:border-blue-300 has-[:checked]:bg-blue-50/30",children:[(0,s.jsx)("div",{className:"relative flex items-center justify-center",children:(0,s.jsx)("input",{type:"radio",value:"yes",...D("saveDetails"),className:"peer w-4 h-4 border border-gray-300 rounded-full appearance-none checked:border-blue-500 checked:border-[5px] transition-all cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-100"})}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:d("saveYes")})]})]})]}),w&&(0,s.jsx)("div",{className:"bg-red-50 border border-red-100 rounded-lg p-4",children:(0,s.jsx)("p",{className:"text-sm text-red-600",children:w})}),(0,s.jsx)("button",{type:"submit",disabled:N,className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg shadow-blue-500/25",children:N?d("submitting"):d("submit")})]})]})]})}},3687:function(e,t,r){"use strict";r.d(t,{jD:function(){return i},rU:function(){return n},tv:function(){return c}});var s=r(7366),a=r(3795);let l=(0,s.R)({locales:["ru","uz"],defaultLocale:"ru",localePrefix:"as-needed"}),{Link:n,redirect:o,usePathname:i,useRouter:c}=(0,a.os)(l)}},function(e){e.O(0,[171,673,626,971,117,744],function(){return e(e.s=4222)}),_N_E=e.O()}]);