"use strict";(()=>{var e={};e.id=976,e.ids=[976],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},932:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>k,patchFetch:()=>g,requestAsyncStorage:()=>y,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h});var i={};r.r(i),r.d(i,{GET:()=>p,POST:()=>d});var n=r(9303),a=r(8716),s=r(670),o=r(7070),u=r(3493),l=r(971),c=r(9178);async function d(e){try{let t=(0,c.Gd)(e);if(!t)return o.NextResponse.json({error:"Unauthorized"},{status:401});let r=await e.json();console.log("Received checkout link data:",r);let i=l.d$.parse(r);console.log("Validated checkout link data:",i);let n=i.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"").substring(0,50);n&&0!==n.length||(n=`product-${Date.now()}`);let a=await u._.checkoutLink.findUnique({where:{sellerId_slug:{sellerId:t,slug:n}}}),s=n;a&&(s=`${n}-${Date.now()}`);let d=await u._.checkoutLink.create({data:{sellerId:t,name:i.name,slug:s,price:i.price,currency:i.currency,defaultQty:i.defaultQty,maxQty:i.maxQty,imageUrl:i.imageUrl||null,sizes:JSON.stringify(i.sizes),deliveryOptions:JSON.stringify(i.deliveryOptions),paymentNote:i.paymentNote}});return o.NextResponse.json(d,{status:201})}catch(e){if("ZodError"===e.name)return o.NextResponse.json({error:"Validation error",details:e.errors},{status:400});return console.error("Error creating checkout link:",e),console.error("Error details:",{name:e.name,message:e.message,stack:e.stack}),o.NextResponse.json({error:"Failed to create checkout link",details:e.message},{status:500})}}async function p(e){try{let t=(0,c.Gd)(e);if(!t)return o.NextResponse.json({error:"Unauthorized"},{status:401});let r=await u._.checkoutLink.findMany({where:{sellerId:t},include:{_count:{select:{orders:!0}}},orderBy:{createdAt:"desc"}});return o.NextResponse.json(r)}catch(e){return console.error("Error fetching checkout links:",e),o.NextResponse.json({error:"Failed to fetch checkout links"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/checkout-links/route",pathname:"/api/checkout-links",filename:"route",bundlePath:"app/api/checkout-links/route"},resolvedPagePath:"/Users/otabek/Downloads/Design/Vibe/Cursor/Bog'la for SME's/app/api/checkout-links/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:y,staticGenerationAsyncStorage:h,serverHooks:f}=m,k="/api/checkout-links/route";function g(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}},9178:(e,t,r)=>{r.d(t,{Gd:()=>c,Zv:()=>u,ed:()=>l});var i=r(2023),n=r.n(i),a=r(3493);async function s(e,t){return n().compare(e,t)}async function o(e){return a._.seller.findUnique({where:{email:e}})}async function u(e,t){let r=await o(e);if(!r||!await s(t,r.password))return null;let{password:i,...n}=r;return n}function l(e){return Buffer.from(`${e}:${Date.now()}`).toString("base64")}function c(e){let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return null;try{let e=t.replace("Bearer ",""),[r]=Buffer.from(e,"base64").toString("utf-8").split(":");return r||null}catch{return null}}},3493:(e,t,r)=>{r.d(t,{_:()=>n});let i=require("@prisma/client"),n=globalThis.prisma??new i.PrismaClient},971:(e,t,r)=>{r.d(t,{Uh:()=>a,d$:()=>n,dm:()=>s});var i=r(1067);let n=i.Ry({name:i.Z_().min(1,"Product name is required"),price:i.Rx().int().positive("Price must be positive"),currency:i.Z_().default("UZS"),defaultQty:i.Rx().int().positive().default(1),maxQty:i.Rx().int().positive().optional().nullable(),imageUrl:i.G0([i.Z_().url("Must be a valid URL"),i.i0("")]).optional(),sizes:i.IX(i.Z_().min(1,"Size cannot be empty")).min(1,"At least one size is required"),deliveryOptions:i.Ry({courierCity:i.O7().optional(),pickup:i.O7().optional(),region:i.O7().optional()}).refine(e=>e.courierCity||e.pickup||e.region,{message:"At least one delivery option must be selected"}),paymentNote:i.Z_().min(1,"Payment instructions are required")}),a=i.Ry({checkoutLinkId:i.Z_().min(1),quantity:i.Rx().int().positive("Quantity must be positive"),selectedSize:i.Z_().min(1,"Size selection is required"),deliveryMethod:i.Z_().min(1,"Delivery method is required"),buyer:i.Ry({fullName:i.Z_().min(1,"Full name is required"),phone:i.Z_().regex(/^\+998\d{9}$/,"Invalid Uzbek phone number format"),city:i.Z_().min(1,"City is required"),address:i.Z_().min(1,"Address is required"),username:i.Z_().optional()}),saveDetails:i.O7().default(!1)});i.Ry({paymentStatus:i.Km(["new","paid","cancelled"]).optional(),deliveryStatus:i.Km(["pending","sent","delivered"]).optional()});let s=i.Ry({email:i.Z_().email("Invalid email address"),password:i.Z_().min(1,"Password is required")})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[276,972,23,67],()=>r(932));module.exports=i})();